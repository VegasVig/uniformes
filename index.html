<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Solicita√ß√£o de Uniforme</title>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body{
  margin:0;
  font-family:'Segoe UI',Arial;
  background:radial-gradient(circle at top,#1a1a1a,#000);
  color:#e5e5e5;
  text-align:center;
}

.container{
  max-width:420px;
  margin:25px auto;
  padding:22px;
  border-radius:18px;
  background:#121212;
  box-shadow:0 10px 30px rgba(0,0,0,.8);
}

.logo{
  width:180px;
  filter:grayscale(100%);
}

.campo{
  display:flex;
  justify-content:center;
}

.campo input,
.campo select,
.campo textarea,
canvas{
  width:100%;
  max-width:360px;
}

input,select,textarea{
  padding:14px;
  margin-top:10px;
  background:#0b0b0b;
  border:1px solid #333;
  border-radius:10px;
  color:white;
}

textarea{
  height:90px;
  resize:none;
}

.item{
  background:#0e0e0e;
  border:1px solid #2a2a2a;
  padding:12px;
  border-radius:12px;
  margin:8px 0;
  text-align:left;
}

canvas{
  height:160px;
  background:white;
  border-radius:12px;
  margin-top:10px;
  touch-action:none;
}

button{
  width:100%;
  max-width:360px;
  padding:15px;
  margin-top:20px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  background:linear-gradient(135deg,#e0e0e0,#7a7a7a);
  cursor:pointer;
}

</style>
</head>

<body>

<div class="container">

<img src="assets/vegaslogo.jpg" class="logo">

<h3>Solicita√ß√£o de Uniforme</h3>

<div class="campo">
<input type="text" id="nome" placeholder="Nome do funcion√°rio">
</div>

<div class="campo">
<select id="posto" onchange="carregarUniformes()">

<option value="">Selecione o Posto</option>
<option value="armado">Vigilante Armado - Geral</option>
<option value="nagumo">Vigilante Nagumo</option>
<option value="royal">Vigilante Royal</option>
<option value="porteiroHSJB">Porteiro HSJB</option>
<option value="porteiroGeral">Porteiro Geral</option>
<option value="projetoVida">Projeto Vida</option>
<option value="asg">ASG</option>
<option value="monitoramento">Monitoramento</option>
<option value="tecnica">√Årea T√©cnica</option>
<option value="administrativo">Administrativo</option>
<option value="comercial">Comercial</option>

</select>
</div>

<div id="uniformes"></div>

<h4>Observa√ß√£o</h4>
<div class="campo">
<textarea id="observacao"></textarea>
</div>

<h4>Assinatura</h4>
<div class="campo">
<canvas id="assinatura"></canvas>
</div>

<div class="campo">
<button onclick="limpar()">Limpar assinatura</button>
</div>

<div class="campo">
<button onclick="enviar()">ENVIAR SOLICITA√á√ÉO</button>
</div>

</div>

<script>

/* ===== UNIFORMES POR POSTO ===== */

const postosUniformes={

armado:[
{nome:"Camisa Operacional",tipo:"roupa"},
{nome:"Cal√ßa T√°tica",tipo:"roupa"},
{nome:"Bota T√°tica",tipo:"sapato"}
],

nagumo:[
{nome:"Camisa Operacional",tipo:"roupa"},
{nome:"Cal√ßa Operacional",tipo:"roupa"},
{nome:"Bota",tipo:"sapato"}
],

royal:[
{nome:"Camisa Social",tipo:"roupa"},
{nome:"Cal√ßa Social",tipo:"roupa"},
{nome:"Sapato Social",tipo:"sapato"}
],

porteiroHSJB:[
{nome:"Polo Porteiro",tipo:"roupa"},
{nome:"Cal√ßa Social",tipo:"roupa"},
{nome:"Sapato Preto",tipo:"sapato"}
],

porteiroGeral:[
{nome:"Polo Porteiro",tipo:"roupa"},
{nome:"Cal√ßa Social",tipo:"roupa"},
{nome:"Sapato Social",tipo:"sapato"}
],

projetoVida:[
{nome:"Camisa Projeto",tipo:"roupa"},
{nome:"Cal√ßa Operacional",tipo:"roupa"},
{nome:"T√™nis Preto",tipo:"sapato"}
],

asg:[
{nome:"Camiseta ASG",tipo:"roupa"},
{nome:"Cal√ßa Brim",tipo:"roupa"},
{nome:"Sapato Antiderrapante",tipo:"sapato"}
],

monitoramento:[
{nome:"Polo Monitoramento",tipo:"roupa"},
{nome:"Cal√ßa Preta",tipo:"roupa"}
],

tecnica:[
{nome:"Camisa T√©cnica",tipo:"roupa"},
{nome:"Cal√ßa Cargo",tipo:"roupa"},
{nome:"Bota Seguran√ßa",tipo:"sapato"}
],

administrativo:[
{nome:"Camisa Social",tipo:"roupa"},
{nome:"Cal√ßa Social",tipo:"roupa"},
{nome:"Sapato Social",tipo:"sapato"}
],

comercial:[
{nome:"Camisa Social",tipo:"roupa"},
{nome:"Cal√ßa Social",tipo:"roupa"},
{nome:"Sapato Social",tipo:"sapato"}
]

};


/* ===== CARREGAR UNIFORMES ===== */

function carregarUniformes(){

const posto=document.getElementById("posto").value;
const div=document.getElementById("uniformes");
div.innerHTML="";

if(!postosUniformes[posto]) return;

postosUniformes[posto].forEach(item=>{

const roupas=["P","M","G","GG","EG"];
const sapatos=Array.from({length:15},(_,k)=>k+34);
const tamanhos=item.tipo==="roupa"?roupas:sapatos;

div.innerHTML+=`
<div class="item">

<label>
<input type="checkbox"> ${item.nome}
</label>

<select>
<option value="">Tamanho</option>
${tamanhos.map(t=>`<option value="${t}">${t}</option>`).join("")}
</select>

</div>`;
});
}


/* ===== ASSINATURA ===== */

const canvas=document.getElementById("assinatura");
const ctx=canvas.getContext("2d");

/* tamanho REAL do canvas */
canvas.width=360;
canvas.height=160;

let desenhando=false;

canvas.addEventListener("pointerdown",()=>desenhando=true);

canvas.addEventListener("pointerup",()=>{
desenhando=false;
ctx.beginPath();
});

canvas.addEventListener("pointermove",(e)=>{
if(!desenhando) return;

const rect=canvas.getBoundingClientRect();

ctx.lineWidth=2;
ctx.lineCap="round";
ctx.lineTo(e.clientX-rect.left,e.clientY-rect.top);
ctx.stroke();
ctx.beginPath();
ctx.moveTo(e.clientX-rect.left,e.clientY-rect.top);
});

function limpar(){
ctx.clearRect(0,0,canvas.width,canvas.height);
}


/* ===== ENVIAR PARA GOOGLE SHEETS ===== */

async function enviar(){

const nome=document.getElementById("nome").value.trim();
const posto=document.getElementById("posto").value;
const obs=document.getElementById("observacao").value;

if(!nome || !posto){
alert("Preencha nome e posto!");
return;
}

/* coletar uniformes */
let lista=[];

document.querySelectorAll(".item").forEach(item=>{

const check=item.querySelector("input[type=checkbox]");
const select=item.querySelector("select");

if(check.checked && select.value){
lista.push(
check.parentNode.innerText.trim()+" - "+select.value
);
}

});

if(lista.length===0){
alert("Selecione ao menos um uniforme");
return;
}

const assinatura=canvas.toDataURL("image/png");

/* URL DO SEU APPS SCRIPT */
const url="https://script.google.com/macros/s/AKfycby-um32V6HBT85NpMwWcI10ZoxEfjusqlGGnEaktB9A3neUSXcIYnKQ8WhEoHRWMtkibg/exec";

const dados={
nome:nome,
posto:posto,
uniformes:lista.join(", "),
observacao:obs,
assinatura:assinatura,
data:new Date().toLocaleString("pt-BR")
};

try{

await fetch(url,{
method:"POST",
mode:"no-cors",   // üî• necess√°rio no Apps Script
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify(dados)
});

alert("‚úÖ Solicita√ß√£o enviada para o estoque!");

document.location.reload();

}catch(e){

alert("Erro ao enviar: "+e);

}

}

</script>

</body>
</html>