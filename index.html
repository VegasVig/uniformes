<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Solicitação de Uniforme - Vegas</title>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#0f1115;
color:white;
display:flex;
justify-content:center;
}

.container{
width:95%;
max-width:700px;
background:#1a1d24;
margin:20px;
padding:25px;
border-radius:12px;
box-shadow:0 0 25px rgba(0,0,0,0.6);
}

.logo{
display:block;
margin:auto;
width:160px;
margin-bottom:20px;
}

h2{
text-align:center;
color:#d1d5db;
}

label{
margin-top:15px;
display:block;
font-weight:bold;
color:#bbb;
}

select,input,textarea{
width:100%;
padding:12px;
margin-top:6px;
border-radius:8px;
border:none;
background:#2a2f38;
color:white;
font-size:15px;
}

textarea{
height:120px;
resize:none;
}

.uniforme-item{
display:flex;
justify-content:space-between;
align-items:center;
background:#232730;
padding:10px;
border-radius:8px;
margin-top:8px;
}

canvas{
background:white;
border-radius:10px;
width:100%;
height:200px;
margin-top:10px;
touch-action:none;
}

button{
width:100%;
margin-top:20px;
padding:15px;
border:none;
border-radius:10px;
background:#3b3f46;
color:white;
font-size:16px;
cursor:pointer;
transition:0.3s;
}

button:hover{
background:#50555e;
}

#recibo{
background:white;
color:black;
padding:20px;
margin-top:20px;
display:none;
}

</style>
</head>

<body>

<div class="container" id="formArea">

<img src="assets/vegaslogo.jpg" class="logo">

<h2>Solicitação de Uniforme</h2>

<label>Nome do Funcionário</label>
<input id="nome">

<label>Posto de Serviço</label>
<select id="posto" onchange="carregarUniformes()">
<option value="">Selecione o Posto</option>
<option value="armado">Vigilante Armado - Geral</option>
<option value="nagumo">Vigilante Nagumo</option>
<option value="royal">Vigilante Royal</option>
<option value="porteiroHSJB">Porteiro HSJB</option>
<option value="porteiroGeral">Porteiro Geral</option>
<option value="projetoVida">Projeto Vida</option>
<option value="asg">ASG</option>
<option value="monitoramento">Monitoramento</option>
<option value="tecnica">Área Técnica</option>
<option value="administrativo">Administrativo</option>
<option value="comercial">Comercial</option>
</select>

<div id="uniformes"></div>

<label>Observações</label>
<textarea id="obs"></textarea>

<label>Assinatura</label>
<canvas id="assinatura"></canvas>

<button onclick="enviar()">Enviar Solicitação</button>

</div>

<div id="recibo"></div>

<script>

const canvas=document.getElementById("assinatura");
const signaturePad=new SignaturePad(canvas);

function resizeCanvas(){
const ratio=Math.max(window.devicePixelRatio||1,1);
canvas.width=canvas.offsetWidth*ratio;
canvas.height=canvas.offsetHeight*ratio;
canvas.getContext("2d").scale(ratio,ratio);
signaturePad.clear();
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

function gerarNumeros(inicio,fim){
let html="";
for(let i=inicio;i<=fim;i++){
html+=`<option>${i}</option>`;
}
return html;
}

function carregarUniformes(){

const posto=document.getElementById("posto").value;
const div=document.getElementById("uniformes");

let calcaOptions="";

if(posto==="asg"){
calcaOptions=`
<option>P</option>
<option>M</option>
<option>G</option>
<option>GG</option>
<option>XG</option>
<option>EXG</option>
<option>EXGG</option>`;
}else{
calcaOptions=gerarNumeros(38,56);
}

div.innerHTML=`

<label>Uniformes</label>

<div class="uniforme-item">
Camisa Social
<select id="camisa">
<option></option>
<option>N2</option>
<option>N3</option>
<option>N4</option>
<option>N5</option>
<option>N6</option>
<option>N7</option>
<option>N8</option>
</select>
</div>

<div class="uniforme-item">
Calça
<select id="calca">
<option></option>
${calcaOptions}
</select>
</div>

<div class="uniforme-item">
Sapato
<select id="sapato">
<option></option>
${gerarNumeros(34,48)}
</select>
</div>
`;
}

async function enviar(){

if(signaturePad.isEmpty()){
alert("Assine antes de enviar");
return;
}

const nome=document.getElementById("nome").value;
const posto=document.getElementById("posto").value;
const camisa=document.getElementById("camisa")?.value||"";
const calca=document.getElementById("calca")?.value||"";
const sapato=document.getElementById("sapato")?.value||"";
const obs=document.getElementById("obs").value;

const assinatura=signaturePad.toDataURL();

await fetch("SUA_URL_DO_APPS_SCRIPT",{
method:"POST",
body:JSON.stringify({
nome,posto,camisa,calca,sapato,obs,assinatura
})
});

gerarPDF(nome,posto,camisa,calca,sapato,obs,assinatura);

alert("Solicitação enviada com sucesso!");
signaturePad.clear();
}

async function gerarPDF(nome,posto,camisa,calca,sapato,obs,assinatura){

const recibo=document.getElementById("recibo");

recibo.style.display="block";
recibo.innerHTML=`
<h2>Comprovante de Solicitação</h2>
<p><b>Funcionário:</b> ${nome}</p>
<p><b>Posto:</b> ${posto}</p>
<p><b>Camisa:</b> ${camisa}</p>
<p><b>Calça:</b> ${calca}</p>
<p><b>Sapato:</b> ${sapato}</p>
<p><b>Observação:</b> ${obs}</p>
<img src="${assinatura}" width="200">
`;

const canvasRecibo=await html2canvas(recibo);

const { jsPDF }=window.jspdf;
const pdf=new jsPDF();

const imgData=canvasRecibo.toDataURL("image/jpeg");
pdf.addImage(imgData,"JPEG",10,10,190,0);
pdf.save("Comprovante_Uniforme.pdf");

recibo.style.display="none";
}

</script>

</body>
</html>