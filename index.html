<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Solicitação de Uniforme</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body{
margin:0;
font-family:'Segoe UI',Arial;
background:radial-gradient(circle at top,#1c1c1c,#000);
color:#e5e5e5;
text-align:center;
}

.container{
max-width:420px;
margin:25px auto;
padding:22px;
border-radius:18px;
background:#121212;
box-shadow:0 10px 30px rgba(0,0,0,.8);
}

.logo{width:180px;margin-bottom:10px;}

.campo{display:flex;justify-content:center;}

.campo input,
.campo select,
.campo textarea,
canvas,
button{
width:100%;
max-width:360px;
}

input,select,textarea{
padding:14px;
margin-top:10px;
background:#0b0b0b;
border:1px solid #333;
border-radius:10px;
color:white;
}

textarea{height:90px;resize:none;}

.item{
background:#0e0e0e;
border:1px solid #2a2a2a;
padding:12px;
border-radius:12px;
margin:8px 0;
text-align:left;
}

canvas{
height:160px;
background:white;
border-radius:12px;
margin-top:10px;
touch-action:none;
}

button{
padding:15px;
margin-top:15px;
border:none;
border-radius:12px;
font-weight:bold;
background:linear-gradient(135deg,#e0e0e0,#7a7a7a);
cursor:pointer;
}

</style>
</head>

<body>

<div class="container">

<img src="assets/vegaslogo.jpg" class="logo">

<h3>Solicitação de Uniforme</h3>

<div class="campo">
<input id="nome" placeholder="Nome do funcionário">
</div>

<div class="campo">
<input id="cpf" placeholder="CPF">
</div>

<div class="campo">
<input id="telefone" placeholder="Telefone">
</div>

<div class="campo">
<select id="posto" onchange="carregarUniformes()">
<option value="">Selecione o Posto</option>
<option value="armado">Vigilante Armado - Geral</option>
<option value="nagumo">Vigilante Nagumo</option>
<option value="royal">Vigilante Royal</option>
<option value="porteiroHSJB">Porteiro HSJB</option>
<option value="porteiroGeral">Porteiro Geral</option>
<option value="projetoVida">Projeto Vida</option>
<option value="asg">ASG</option>
<option value="monitoramento">Monitoramento</option>
<option value="tecnica">Área Técnica</option>
<option value="administrativo">Administrativo</option>
<option value="gerencia">Administrativo Gerência</option>
<option value="comercial">Comercial</option>
</select>
</div>

<div id="uniformes"></div>

<h4>Observação</h4>
<div class="campo">
<textarea id="observacao"></textarea>
</div>

<h4>Assinatura</h4>
<div class="campo">
<canvas id="assinatura"></canvas>
</div>

<div class="campo">
<button onclick="limpar()">Limpar assinatura</button>
</div>

<div class="campo">
<button onclick="enviar()">ENVIAR SOLICITAÇÃO</button>
</div>

</div>

<script>

/* ======= MASCARAS ======= */

cpf.oninput=e=>{
let v=e.target.value.replace(/\D/g,'').slice(0,11);
v=v.replace(/(\d{3})(\d)/,'$1.$2');
v=v.replace(/(\d{3})(\d)/,'$1.$2');
v=v.replace(/(\d{3})(\d{1,2})$/,'$1-$2');
e.target.value=v;
};

telefone.oninput=e=>{
let v=e.target.value.replace(/\D/g,'').slice(0,11);
if(v.length>10)
v=v.replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3');
else
v=v.replace(/(\d{2})(\d{4})(\d{4})/,'($1) $2-$3');
e.target.value=v;
};

/* ================= UNIFORMES ================= */

const postosUniformes={
armado:["Camisa vigilante bege","Calça vigilante tática","Blusa preta vigilância","Casaco vigilância","Gravata","Capa para placa balística","Boné","Fiel","Apito","Coturno","Cinto","Cinto tático","Coldre","Baleiro","Touca vegas vigilância"],

nagumo:["Blazer","Calça social","Camisa social branca","Gravata","Sapato social","Botom preto vigilante"],

royal:["Blazer","Calça social","Camisa social branca","Gravata","Sapato social","Botom preto vigilante","Coldre axilar","Baleiro","Capa para placa balística","Fiel","Apito"],

porteiroHSJB:["Blazer","Calça social","Camisa social branca","Gravata","Sapato social","Botom branco serviços"],

porteiroGeral:["Camisa porteiro cinza","Calça social","Blusa preta serviços","Casaco preto serviços","Boné","Botina","Touca vegas vigilância"],

projetoVida:["Blusa preta serviços","Calça social","Casaco preto serviços","Boné","Botina","Touca vegas vigilância"],

asg:["Camisa ASG cinza","Calça elástico cinza","Blusa preta serviços","Casaco preto serviços","Botina","Galocha"],

monitoramento:["Blusa preta vigilância","Casaco preto vigilância"],

tecnica:["Blusa preta vigilância","Calça jeans","Casaco preto vigilância","Boné","Par de Botina"],

administrativo:["Blusa preta vigilância","Casaco preto vigilância"],

gerencia:["Camisa social preta","Casaco preto vigilância"],

comercial:["Camisa social preta","Casaco preto vigilância"]
};

/* ===== TAMANHOS ===== */

function carregarUniformes(){

const posto=document.getElementById("posto").value;
const div=document.getElementById("uniformes");
div.innerHTML="";

if(!postosUniformes[posto]) return;

postosUniformes[posto].forEach(nome=>{

let tamanhos=null;

if(/sapato|botina|coturno|galocha/i.test(nome))
tamanhos=Array.from({length:15},(_,i)=>i+34);

else if(/camisa social/i.test(nome))
tamanhos=["N2","N3","N4","N5","N6","N7","N8"];

else if(posto==="asg" && /calça/i.test(nome))
tamanhos=["P","M","G","GG","XG","EXG","EXGG"];

else if(/calça/i.test(nome))
tamanhos=Array.from({length:10},(_,i)=>i+38);

else if(/camisa|blusa|casaco/i.test(nome))
tamanhos=["P","M","G","GG","EG"];

div.innerHTML+=`
<div class="item">
<label><input type="checkbox"> ${nome}</label>
${tamanhos?`
<select>
<option>Tamanho</option>
${tamanhos.map(t=>`<option>${t}</option>`).join("")}
</select>`:""}
</div>`;
});

}

/* ===== ASSINATURA ===== */

const canvas=document.getElementById("assinatura");
const ctx=canvas.getContext("2d");

canvas.width=360;
canvas.height=160;

let desenhando=false;

canvas.onpointerdown=()=>desenhando=true;
canvas.onpointerup=()=>{desenhando=false;ctx.beginPath();};
canvas.onpointermove=e=>{
if(!desenhando)return;
const r=canvas.getBoundingClientRect();
ctx.lineWidth=2;
ctx.lineCap="round";
ctx.lineTo(e.clientX-r.left,e.clientY-r.top);
ctx.stroke();
ctx.beginPath();
ctx.moveTo(e.clientX-r.left,e.clientY-r.top);
};

function limpar(){
ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* ===== ENVIO ===== */

async function enviar(){

const nome=document.getElementById("nome").value;
const cpf=document.getElementById("cpf").value;
const telefone=document.getElementById("telefone").value;
const postoSel=document.getElementById("posto");
const posto=postoSel.options[postoSel.selectedIndex].text;
const obs=document.getElementById("observacao").value;

if(!nome || cpf.length<14 || telefone.length<14 || !postoSel.value){
alert("Preencha todos os dados.");
return;
}

let lista=[];

document.querySelectorAll(".item").forEach(item=>{
const check=item.querySelector("input");
const select=item.querySelector("select");

if(check.checked){
lista.push(
select?check.parentNode.innerText.trim()+" - "+select.value
:check.parentNode.innerText.trim()
);
}
});

if(lista.length===0){
alert("Selecione uniforme");
return;
}

const assinatura=canvas.toDataURL();

/* GOOGLE SHEETS */
await fetch("https://script.google.com/macros/s/AKfycby8p31tT29-Nn7oMfFGNHMuG1v7VPcrRQCt_5AmyJ1Hv5PnvftaLRkak2jp54K1SARC2w/exec",{
method:"POST",
body:JSON.stringify({
data:new Date().toLocaleString("pt-BR"),
nome,
cpf,
telefone,
posto,
uniformes:lista.join(", "),
observacao:obs
})
});

/* PDF */

const { jsPDF } = window.jspdf;
const pdf=new jsPDF();

pdf.setFontSize(16);
pdf.text("COMPROVANTE DE SOLICITAÇÃO",20,20);

pdf.setFontSize(12);
pdf.text("Funcionário: "+nome,20,40);
pdf.text("CPF: "+cpf,20,50);
pdf.text("Telefone: "+telefone,20,60);
pdf.text("Posto: "+posto,20,70);

let y=85;

pdf.text("Uniformes solicitados:",20,y);
y+=10;

lista.forEach(u=>{
const linhas=pdf.splitTextToSize("- "+u,170);
linhas.forEach(l=>{
pdf.text(l,20,y);
y+=7;
if(y>270){pdf.addPage();y=20;}
});
});

pdf.text("Observação: "+(obs||"Nenhuma"),20,y+10);

pdf.text("Assinatura:",20,y+25);
pdf.addImage(assinatura,"PNG",20,y+30,80,40);

pdf.text("Data: "+new Date().toLocaleString("pt-BR"),20,y+75);

pdf.save("comprovante_uniforme.pdf");

alert("Solicitação enviada com sucesso!");

}

</script>

</body>
</html>